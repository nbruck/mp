<html t:type="mainLayout"
      p:title="prop:pagetitle"
      p:robot="literal:noxindex,nofollow"
      p:navigation="prop:navigation"
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
      xmlns:p="tapestry:parameter">

    <div id="resultpage">
        <div class="wrapper round boxShadow">
            <t:if test="mileageResultAvailable"/>

            <t:if test="errorMessage">
                <h2>${prop:errorMessage}</h2>

                <t:backtomainpage/>
            </t:if>

            <t:delegate to="prop:activeBlock"/>
            <t:if test="showEnterComponent">
                <br/>
                <t:outputRaw value="message:txt.mileageenter.alternativ"/>
            </t:if>
        </div>

        <t:if test="showEnterComponent">
            <t:mileageEnterComponent carIdParameter="carId" headerLabel="message:txt.fieldset.legend.mileage-enter"/>
        </t:if>
    </div>

    <t:block t:id="viewOnlyBlock">
        <t:if test="otherMessage">
            <h2>
                ${prop:otherMessage}
            </h2>
        </t:if>
        <t:if test="mileageResultAvailable">
            <div id="result">
                <t:resultRenderer showCarTrustLevel="prop:showTrustLevelOfCarData" storingDate="prop:storingDate"/>

                <t:backtomainpage/>
            </div>
        <p:else>
            <t:trigger event="showEnterComponent"/>
        </p:else>
        </t:if>
    </t:block>

    <t:block t:id="newCarBlock">
        <!-- here we can decide if we want to show trustlevel and different messages -->
            <h2>
                ${message:success.mileage.stored}
            </h2>

        <t:delegate to="block:sharedBlockForNewAndNoRegdate"/>
    </t:block>

    <t:block t:id="noRegdateStoredBeforeBlock">
            <h2>
                ${message:success.mileage.updated}
            </h2>

        <t:delegate to="block:sharedBlockForNewAndNoRegdate"/>
    </t:block>

    <t:block t:id="sharedBlockForNewAndNoRegdate">
        <span>
            <t:outputRaw value="message:success.mileage.stored.optional"/>
        </span>
        <br/>
        <br/>
        <br/>
        <t:registrationDateComponent t:buttonBlock="block:yesOrNoButtonBlock"/>
    </t:block>

    <t:block t:id="regDateStoredBeforeBlock">
        <h2>
            ${message:success.mileage.updated}
        </h2>
        <t:delegate to="block:viewOnlyBlock"/>
    </t:block>

    <t:block t:id="yesOrNoButtonBlock">
        <t:submit t:id="yesStore" value="message:submit.yes-store.txt" class="round"/>
        <t:submit t:id="noThankYou" value="message:submit.no-thank-you.txt" class="round"/>
    </t:block>

    <t:block t:id="fallbackBlock">
        <t:trigger event="gotoErrorPage"/>
    </t:block>

<t:remove><!-- <t:outputRaw value="message:global.operators.lower-than"/> --></t:remove>
<script type="text/javascript">
var ebcdic={A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:1,K:2,L:3,M:4,N:5,O:0,P:7,Q:8,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9,"%C4":1,"%D6":0,"%DC":4,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},weight=[9,8,7,6,5,4,3,2,10,9,8,7,6,5,4,3,2],messages={vinEnter:"${message:txt.input.vin.placeholder}",mileageEnter:"${message:global.txt.input.mileage.placeholder}",vinSearch:"${message:txt.input.vin.placeholder}"};
function check(a,e){if(a.value.length==17){var c=a.value.toUpperCase();a=c.split("");var b=0;c=c.length;for(var d=0;d<t:outputRaw value="message:global.operators.lower-than"/>c;d++){var f=ebcdic[escape(a[d])];if(f==null)return;b+=f*weight[d]}b%=11;if(b==10)b="X";document.getElementById("checkDigit"+e).innerHTML=b;document.getElementById("container"+e).style.display="block"}}function handleFocus(a){a.className+=" active";tooglePlaceholder(a)}function handleBlur(a){a.className="round";tooglePlaceholder(a)}
function tooglePlaceholder(a){if(a.value===messages[a.id]){a.style.color="#777";a.value=""}else if(a.value===""){a.style.color="#999";a.value=messages[a.id]}};
</script>

</html>
